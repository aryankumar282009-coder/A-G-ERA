<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AG ERA</title>

<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:black;color:white;padding:15px}
.header-top{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
nav{display:flex;justify-content:center;gap:20px;background:#1a1a1a;padding:10px}
nav a{color:white;text-decoration:none;font-weight:bold}

.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:30px}
.card{background:white;padding:15px;border-radius:10px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,0.1)}
.card img{width:100%;height:220px;object-fit:cover}

.actions{display:flex;gap:8px;justify-content:center;margin-top:10px}
.actions button{padding:8px;border:none;border-radius:5px;font-weight:bold}
.cart{background:black;color:white}
.buy{background:orange}

.popup{
display:none;position:fixed;top:50%;left:50%;
transform:translate(-50%,-50%);
background:white;padding:20px;width:90%;max-width:400px;
box-shadow:0 0 20px rgba(0,0,0,.5);
z-index:9999;
}

input,select,button{width:100%;padding:10px;margin:8px 0}
</style>
</head>

<body>

<header>
  <div class="header-top">
    <h2>AG ERA</h2>
    <input id="search" placeholder="Search" onkeyup="filterProducts()">
  </div>
</header>

<nav>
<a href="#" onclick="setFilter('all')">Home</a>
<a href="#" onclick="setFilter('Men')">Men</a>
<a href="#" onclick="setFilter('Women')">Women</a>
<a href="#" onclick="openCart()">Cart ðŸ›’</a>
</nav>

<div class="products" id="productList"></div>

<!-- CART -->
<div class="popup" id="cartBox">
<h3>Your Cart</h3>
<div id="cartItems"></div>
<h4>Total â‚¹<span id="total">0</span></h4>
<button onclick="checkout()">Checkout</button>
<button onclick="cartBox.style.display='none'">Close</button>
</div>

<!-- OTP LOGIN -->
<div class="popup" id="loginBox">
<h3>Verify Phone</h3>
<input id="uphone" placeholder="10 digit phone">
<div id="recaptcha-container"></div>
<button onclick="sendOTP()">Send OTP</button>

<input id="otp" placeholder="Enter OTP" style="display:none">
<button onclick="verifyOTP()" id="verifyBtn" style="display:none">Verify</button>
</div>

<!-- ADDRESS -->
<div class="popup" id="addressBox">
<h3>Delivery Address</h3>
<input id="aname" placeholder="Full Name">
<input id="address" placeholder="Full Address">
<input id="pincode" placeholder="Pincode">
<button onclick="payNow()">Pay via UPI</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const app = initializeApp({
apiKey:"AIzaSyAh6-HK90YwIjWI5lAXJ7fUd2kP0o-33d4",
authDomain:"aryan-8efc1.firebaseapp.com",
projectId:"aryan-8efc1"
});

const db = getFirestore(app);
const auth = getAuth(app);

let allProducts=[], cart=[], currentProduct=null;
let confirmationResult;

// Initialize reCAPTCHA
window.recaptchaVerifier = new RecaptchaVerifier("recaptcha-container",{size:"normal"},auth);

/* PRODUCTS */
async function loadProducts(){
  const snap = await getDocs(collection(db,"products"));
  allProducts = [];
  snap.forEach(d => allProducts.push(d.data()));
  render(allProducts);
}

function render(list){
  productList.innerHTML="";
  list.forEach(p=>{
    productList.innerHTML+=`
    <div class="card">
      <img src="${p.image}">
      <h3>${p.name}</h3>
      <p>â‚¹${p.price}</p>
      <p>Size: ${p.size}</p>
      <div class="actions">
        <button class="cart" onclick='addToCart(${JSON.stringify(p)})'>Add</button>
        <button class="buy" onclick='buyNow(${JSON.stringify(p)})'>Buy</button>
      </div>
    </div>`;
  });
}

/* CART */
window.addToCart = p => {cart.push(p); alert("Added to cart");}
window.openCart = ()=>{
  cartBox.style.display="block";
  cartItems.innerHTML="";
  let t=0;
  cart.forEach(p=>{
    cartItems.innerHTML+=`<p>${p.name} - â‚¹${p.price}</p>`;
    t+=Number(p.price);
  });
  total.innerText=t;
}

/* BUY FLOW */
window.buyNow = p => {
  currentProduct = p;
  cart = [p]; // single product purchase
  loginBox.style.display="block"; // first show OTP login
}

window.checkout = () => {
  if(cart.length===0){alert("Cart is empty"); return;}
  loginBox.style.display="block";
}

/* OTP LOGIN */
window.sendOTP = async () => {
  if(uphone.value.length !== 10) return alert("Invalid phone");
  confirmationResult = await signInWithPhoneNumber(auth,"+91"+uphone.value, window.recaptchaVerifier);
  otp.style.display="block";
  verifyBtn.style.display="block";
  alert("OTP Sent");
}

window.verifyOTP = async () => {
  await confirmationResult.confirm(otp.value);
  loginBox.style.display="none";
  addressBox.style.display="block";
  // Pre-fill address name
  aname.value = uphone.value;
}

/* PAYMENT */
window.payNow = () => {
  if(!address.value || !pincode.value || !aname.value) return alert("Fill address");
  let amt = currentProduct.price;
  window.location.href = `upi://pay?pa=9354189671-1@naviaxis&pn=AGERA&am=${amt}&cu=INR`;
}

/* FILTER */
window.filterProducts = ()=> {
  let q = search.value.toLowerCase();
  render(allProducts.filter(p=>p.name.toLowerCase().includes(q)));
}

window.setFilter = c => {
  render(c==="all"?allProducts:allProducts.filter(p=>p.category===c));
}

loadProducts();
</script>
</body>
</html>
