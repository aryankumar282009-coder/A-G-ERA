<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AG ERA</title>
<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:black;color:white;padding:15px;display:flex;align-items:center;justify-content:space-between}
.header-left{display:flex;gap:15px;align-items:center;}
.header-left h2{margin:0;}
nav{display:flex;justify-content:center;gap:20px;background:#1a1a1a;padding:10px}
nav a{color:white;text-decoration:none;font-weight:bold}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:30px}
.card{background:white;padding:15px;border-radius:10px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,0.1)}
.card img{width:100%;height:220px;object-fit:cover;border-radius:5px}
.actions{display:flex;gap:8px;justify-content:center;margin-top:10px}
.actions button{padding:8px;border:none;border-radius:5px;font-weight:bold}
.cart{background:black;color:white}
.buy{background:orange}
.popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;width:90%;max-width:400px;box-shadow:0 0 20px rgba(0,0,0,.5)}
input,select,button{width:100%;padding:10px;margin:8px 0}
#panel{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border:2px solid #000;max-width:400px;box-shadow:0 0 20px rgba(0,0,0,.5)}
.top-left-menu{position:fixed;top:15px;left:15px;background:white;padding:10px;border-radius:5px;box-shadow:0 0 10px rgba(0,0,0,.2);display:flex;flex-direction:column;gap:5px;z-index:1000}
.top-left-menu button{width:120px;font-size:14px;padding:5px;}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <h2>AG ERA</h2>
  </div>
  <input id="search" placeholder="Search" onkeyup="filterProducts()">
</header>

<nav>
<a href="#" onclick="setFilter('all')">Home</a>
<a href="#" onclick="setFilter('Men')">Men</a>
<a href="#" onclick="setFilter('Women')">Women</a>
<a href="#" onclick="openCart()">Cart ðŸ›’</a>
</nav>

<div class="products" id="productList"></div>

<!-- TOP LEFT MENU -->
<div class="top-left-menu">
<button onclick="toggleOrders()">My Orders</button>
<button onclick="toggleAccount()">My Account</button>
<button onclick="toggleSettings()">Settings</button>
</div>

<!-- CART -->
<div class="popup" id="cartBox">
<h3>Your Cart</h3>
<div id="cartItems"></div>
<h4>Total â‚¹<span id="total">0</span></h4>
<button onclick="checkout()">Checkout</button>
<button onclick="cartBox.style.display='none'">Close</button>
</div>

<!-- OTP LOGIN -->
<div class="popup" id="loginBox">
<h3>Verify Phone</h3>
<input id="uphone" placeholder="10 digit phone">
<div id="recaptcha-container"></div>
<button onclick="sendOTP()">Send OTP</button>

<input id="otp" placeholder="Enter OTP" style="display:none">
<button onclick="verifyOTP()" id="verifyBtn" style="display:none">Verify</button>
</div>

<!-- ADDRESS -->
<div class="popup" id="addressBox">
<h3>Delivery Address</h3>
<input id="aname" placeholder="Full Name">
<input id="address" placeholder="Full Address">
<input id="pincode" placeholder="Pincode">
<button onclick="payNow()">Pay via UPI</button>
</div>

<!-- MY ORDERS -->
<div class="popup" id="ordersBox">
<h3>My Orders</h3>
<div id="ordersList"></div>
<button onclick="ordersBox.style.display='none'">Close</button>
</div>

<!-- ADMIN PANEL -->
<button style="position:fixed;bottom:15px;right:15px;padding:15px;background:black;color:white;border-radius:50%;" onclick="panel.style.display='block'">ðŸ”’</button>
<div id="panel">
<h3>Owner Dashboard</h3>
<select id="category"><option>Men</option><option>Women</option></select>
<input id="name" placeholder="Product Name">
<input id="price" placeholder="Price">
<select id="size"><option>S</option><option>M</option><option>L</option><option>XL</option></select>
<input type="file" id="img">
<button id="addProductBtn">Add Product</button>
<p id="addStatus" style="color:green;"></p>
<button onclick="panel.style.display='none'">Close</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const app = initializeApp({
apiKey:"AIzaSyAh6-HK90YwIjWI5lAXJ7fUd2kP0o-33d4",
authDomain:"aryan-8efc1.firebaseapp.com",
projectId:"aryan-8efc1"
});

const db = getFirestore(app);
const auth = getAuth(app);

let allProducts=[], cart=[], currentUser=null;

/* RECAPTCHA */
window.recaptchaVerifier = new RecaptchaVerifier("recaptcha-container",{size:"normal"},auth);
let confirmationResult;

/* LOAD PRODUCTS */
async function loadProducts(){
const snap=await getDocs(collection(db,"products"));
allProducts=[];
snap.forEach(d=>allProducts.push(d.data()));
render(allProducts);
}

function render(list){
productList.innerHTML="";
list.forEach(p=>{
productList.innerHTML+=`
<div class="card">
<img src="${p.image}">
<h3>${p.name}</h3>
<p>â‚¹${p.price}</p>
<p>Size: ${p.size}</p>
<div class="actions">
<button class="cart" onclick='addToCart(${JSON.stringify(p)})'>Add</button>
<button class="buy" onclick='buyNow(${JSON.stringify(p)})'>Buy</button>
</div>
</div>`;
});
}

/* CART */
window.addToCart=p=>{cart.push(p);alert("Added");}
window.openCart=()=>{
cartBox.style.display="block";
cartItems.innerHTML="";
let t=0;
cart.forEach(p=>{
cartItems.innerHTML+=`<p>${p.name} - â‚¹${p.price}</p>`;
t+=Number(p.price);
});
total.innerText=t;
}
window.buyNow=p=>{cart=[p];openCart();}
window.checkout=()=>loginBox.style.display="block";

/* OTP */
window.sendOTP=async()=>{
if(uphone.value.length!==10) return alert("Invalid phone");
confirmationResult = await signInWithPhoneNumber(auth,"+91"+uphone.value,window.recaptchaVerifier);
otp.style.display="block"; verifyBtn.style.display="block";
alert("OTP Sent");
}
window.verifyOTP=async()=>{
await confirmationResult.confirm(otp.value);
currentUser={phone:uphone.value};
loginBox.style.display="none";
addressBox.style.display="block";
}

/* PAYMENT */
window.payNow=async()=>{
if(!address.value||!pincode.value||!aname.value) return alert("Fill address");
let amt=0;
cart.forEach(p=>amt+=Number(p.price));

for(let p of cart){
await addDoc(collection(db,"orders"),{
product:p.name,
price:p.price,
size:p.size,
category:p.category,
user:currentUser.phone,
status:"Paid",
address:address.value,
name:aname.value,
pincode:pincode.value,
timestamp:new Date()
});
}

alert("Payment done successfully!");
cart=[];
addressBox.style.display="none";
loadProducts();
}

/* MY ORDERS */
function toggleOrders(){
ordersBox.style.display = ordersBox.style.display==="block"?"none":"block";
const q = query(collection(db,"orders"),orderBy("timestamp","desc"));
onSnapshot(q,snap=>{
ordersList.innerHTML="";
snap.forEach(d=>{
const od=d.data();
if(od.user===currentUser?.phone)
ordersList.innerHTML+=`<p>${od.product} - â‚¹${od.price} - ${od.status}</p>`;
});
});
}

/* ACCOUNT MENU */
function toggleAccount(){
if(currentUser) alert(`Logged in as: ${currentUser.phone}`);
else alert("Not logged in");
}
function toggleSettings(){ alert("Settings coming soon"); }

/* FILTER */
window.filterProducts=()=>{ let q=search.value.toLowerCase(); render(allProducts.filter(p=>p.name.toLowerCase().includes(q))); }
window.setFilter=c=>{ render(c==="all"?allProducts:allProducts.filter(p=>p.category===c)); }

/* ADMIN PANEL PRODUCT ADD */
const addProductBtn = document.getElementById("addProductBtn");
const addStatus = document.getElementById("addStatus");

addProductBtn.addEventListener("click", async () => {
const productName = document.getElementById("name").value;
const productPrice = document.getElementById("price").value;
const productSize = document.getElementById("size").value;
const productCategory = document.getElementById("category").value;
const productImg = document.getElementById("img").files[0];

if(!productName||!productPrice||!productSize||!productCategory||!productImg){ alert("Fill all fields"); return; }

const reader = new FileReader();
reader.onload = async (e)=>{
try{
await addDoc(collection(db,"products"),{
name:productName,price:productPrice,size:productSize,
category:productCategory,image:e.target.result
});
addStatus.innerText="Product added successfully!";
panel.style.display="none";
loadProducts();
}catch(err){ console.error(err); addStatus.innerText="Error adding product"; }
};
reader.readAsDataURL(productImg);
});

loadProducts();
</script>
</body>
</html>
